<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="styles.css">
<title>PayU Profile</title>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    function Purchase(){
        document.querySelectorAll('.purchase-button').forEach(button => {
            button.addEventListener('click', function() {
                var name = this.getAttribute('data-name');
                var point = this.getAttribute('data-point');
                var quantity = this.closest('.gift-card-info').querySelector('input[type="number"]').value;
                //여기 ajax문 마무리해오셈.
                $.ajax({
                method: 'POST',
                url: 'http://localhost:8080/purchase',
                headers:' '
                data: {
                    //여기 dto맞춰서 전달해주고.
                },
                success: function(response) {
                    alert(response);
                },
                error: function(xhr, status, error) {
                    console.error('Error:', error);
                    alert('구매 실패.: ' + error);
                }
            });
        });
    });
}
    
    function manageLoginState(){
        var accessToken = sessionStorage.getItem('accessToken');
            if (accessToken !== null && accessToken !== '') { //accessToken이 존재할 때.
                sessionStorage.clear("accessToken");          //session Clear. 
                alert('로그아웃 되었습니다.');
                location.href = "../sign/login.html"
            }
            else {
                location.href = "../sign/login.html"
            }
    }
    function updateQuantityControls() {
        document.querySelectorAll('.quantity-decrease').forEach(button => {
            button.addEventListener('click', function() {
                let quantityInput = this.nextElementSibling;
                let currentValue = parseInt(quantityInput.value);
                if (currentValue > 0) {
                    quantityInput.value = currentValue - 1;
                }
            });
        });
        document.querySelectorAll('.quantity-increase').forEach(button => {
            button.addEventListener('click', function() {
                let quantityInput = this.previousElementSibling;
                quantityInput.value = parseInt(quantityInput.value) + 1;
            });
        });
    }
</script>
</head>
<body>
<div class="header">
    <button class="back-button">←</button>
    <h1><a href ="../mypage/mypage.html">PayU</a></h1>
    <div class="menu">≡</div>
    <div class="side-menu">
        <ul>
            <li><button class="close-button">X</button></li>
            <li><a href ="../mypage/mypage.html">내 프로필</a></li>
            <li><a href ='../giftcard/buygiftcard.html'>상품권 구매</a></li>
            <li>상품권 포인트 교환</li>
            <li id = "loginBtn" onclick ="manageLoginState()"></li>
            <script>
                    function checkLoginState() {
                        var loginBtn = document.getElementById('loginBtn');
                        console.log(loginBtn);
                        var accessToken = sessionStorage.getItem('accessToken');
                        if (accessToken !== null && accessToken !== '') {
                            loginBtn.innerHTML = "로그아웃";
                        } 
                        else {
                            loginBtn.innerHTML = "로그인";
                        }
                    }
               checkLoginState();
            </script>
        </ul>
    </div>
    <script>
        document.querySelector('.menu').addEventListener('click', function() {
            document.querySelector('.side-menu').classList.add('active');
        });

        document.querySelector('.close-button').addEventListener('click', function() {
            document.querySelector('.side-menu').classList.remove('active');
        });
    </script>
</div>
<div id="gift-card-section">
</div>
<script>
    function loadGiftCard(){
        $.ajax({
        method: 'GET',
        url: 'http://localhost:8080/giftcard',
        success: function(response) {
            var giftCardSection = document.getElementById('gift-card-section');
            console.log(response);
            for(let i=0;i<response.length;i++){
                var name = response[i].name;
                var amount = response[i].amount;
                var point = response[i].point;
                var count = response[i].count;
                var giftcard = `<div class="gift-card">
                    <img src="giftcard2.jpg" alt="Gift Card 2">
                    <div class="gift-card-info">
                        <h2>${name}</h2>
                        <p>Price: ${amount}p</p>
                        <div class="quantity-controls">
                            <button class="quantity-decrease">-</button>
                            <input type="number" value="0" min="0">
                            <button class="quantity-increase">+</button>
                        </div>
                        <div class="purchase-info">
                            <p class="sales-quantity">남은 개수: ${count}</p>
                            <p class="total-price">결제 금액: ${point}원</p>
                        </div>
                        <button class="purchase-button" disabled>Buy</button>
                    </div>
                </div>`
                giftCardSection.innerHTML += giftcard;
                updateQuantityControls(); 
            }
           
        },
        error: function(xhr, status, error) {
            console.error('Error:', error);
            alert(error);
        }
    });
    }
    loadGiftCard()
</script>
</body>
</html>
